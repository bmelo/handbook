
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Multivariate pattern analysis &#8212; The Princeton Handbook for Reproducible Neuroimaging</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <link rel="canonical" href="https://brainhack-princeton.github.io/handbook//content_pages/05-02-mvpa.html" />
    <link rel="shortcut icon" href="../_static/tigerBrain_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Surface-based analysis" href="05-03-surfaceBased.html" />
    <link rel="prev" title="Univariate regression and temporal filtering" href="05-01-univariate.html" />
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    div.body {
      min-width: initial;
      max-width: initial;
    }
  </style>

  
  <link rel="canonical" href="https://handbook.datalad.org/content_pages/05-02-mvpa/"/>
  <meta property="og:url" content="https://handbook.datalad.org/content_pages/05-02-mvpa">
  

  <link rel="icon" type="image/png" href="https://media.readthedocs.org/images/favicon.png">

  <meta name="twitter:card" content="summary">
  <meta property="twitter:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:image" content="https://handbook.datalad.org/_static/social-card.jpg">
  <meta property="og:title" content="Multivariate pattern analysis &#8212; The Princeton Handbook for Reproducible Neuroimaging">
  <meta property="og:type" content="article">
  
  <meta property="og:description" content="">


  </head><body>
  <script type="text/javascript">

  $(window).scroll(function () {
    var s = $(window).scrollTop(),
          d = $(document).height(),
          c = $(window).height();
          scrollPercent = (s / (d-c)) * 100;
          var position = scrollPercent;

     $("#progressbar").attr('value', position);
  });
  </script>

  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><p class="logo">
  <a href="../index.html">
    <img class="logo" width="500" src="../_static/tigerBrain.png" title="The Princeton Handbook on Reproducible Neuroimaging"/>
  </a>
</p>

<!-- <p style="margin-left:auto; margin-right: auto;"><iframe src="https://ghbtns.com/github-btn.html?repo=book&user=datalad-handbook&type=star&count=true&size=large" allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe></p> -->

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" /> -->
<style>
.algolia-autocomplete{
  width: 100%;
  height: 1.5em
}
.algolia-autocomplete a{
  border-bottom: none !important;
}
#doc_search{
  width: 100%;
  height: 100%;
}
</style>

<progress id="progressbar" value="0" max="100"></progress>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Multivariate pattern analysis</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#how-to-preprocess-your-data-regress-out-noise-or-not-that-is-the-question">How to preprocess your data: regress out noise or not, that is the question</a></li>
<li><a class="reference internal" href="#scikit-learn">Scikit-learn</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="05-01-univariate.html" title="previous chapter">Univariate regression and temporal filtering</a></li>
      <li>Next: <a href="05-03-surfaceBased.html" title="next chapter">Surface-based analysis</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            <div style="display:block;position:relative; margin-bottom: 1em;">
              <div style="display:block;width:100%;padding-top:12.5%;"></div>
              <div class="rpad" data-unit="8x1" style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;"></div>
            </div>
            
  <div class="section" id="multivariate-pattern-analysis">
<span id="mvpa"></span><h1>Multivariate pattern analysis<a class="headerlink" href="#multivariate-pattern-analysis" title="Permalink to this headline">¶</a></h1>
<style> .blue {color:blue} </style>
<style> .red {color:red} </style><div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>You may hear people describing an analysis as “MVPA,” “multivariate pattern analysis,” or “multivoxel pattern analysis,” or simply “decoding. This has always confused me, but I’m pretty sure this means the same thing. Basically, the questions you’re asking when doing MVPA are different than typical “univariate” analysis. Instead of thinking of information involving a response to a stimuli, you’re thinking of information stored in a pattern of activity, distributed across different voxels. Some may increase activity and some may decrease activity, and together the pattern of activation encodes a stimulus, thought, etc.</p>
</div>
<div class="section" id="how-to-preprocess-your-data-regress-out-noise-or-not-that-is-the-question">
<h2>How to preprocess your data: regress out noise or not, that is the question<a class="headerlink" href="#how-to-preprocess-your-data-regress-out-noise-or-not-that-is-the-question" title="Permalink to this headline">¶</a></h2>
<p>We’ve spent a fair amount of time during pyger meetings arguing this point. Basically if you want to do multivariate analysis, you need to get a voxel X TR matrix. But where does the time series come from? How much should you do to the data before getting this matrix? There are two modes of thought (at least) in this domain:</p>
<p><strong>(1) - Treat the data as “raw” signal after preprocessing</strong></p>
<p>This is how people in the Norman lab and (Manoj et al.) think of preprocessing the data. Basically, we want to leave the single in as much of a raw form as possible. Some think that regressing out motion can introduce noise into your data if motion is involved in the task. After getting the data preprocessed in fmriprep, we would load the data into python and preprocessing the data with the following steps:
Spatially smooth
Highpass filter
Z-score</p>
<p><strong>(2) - Regress out motion and/or use betas</strong></p>
<p><strong>(2a) - Regressing out motion only</strong></p>
<p>In this case, you would set up a GLM with the motion confounds (or whichever other confounds you wanted to add like CSF etc.) from fmirpep. You wouldn’t have any task labels; you would only regress out the motion. Then, you would take the residual timeseries and continue your analysis as described in (1).</p>
<p><strong>(2b) - Regressing out motion and setting up a GLM with task stimuli</strong></p>
<p>In this case, you want to do MVPA on <em>beta coefficients</em> instead of BOLD activation. You need to set up your design matrix so that each trial/TR is separate. However many stimulus labels you set (plus constrasts) will determine how many betas your model will calculate. So if you want to train on faces vs. scenes, do not only make 1 face label and 1 scene label. If you did this, you will only get 1 beta value/voxel for face and 1 beta value/voxel for scene. This is usually not enough samples to train for MVPA, unless you’re doing some across subject analysis. Thus, you should probably make face_TR1, face_TR2, etc. separate labels so you get an abbreviate time series out of your results to use for MVPA.</p>
</div>
<div class="section" id="scikit-learn">
<h2>Scikit-learn<a class="headerlink" href="#scikit-learn" title="Permalink to this headline">¶</a></h2>
<p>Here’s a <a class="reference external" href="https://scikit-learn.org/stable/tutorial/machine_learning_map/index.html">very wonderful flowchart</a> to figure out which model to use.</p>
<p>Potential pitfalls/best practices:</p>
<ul class="simple">
<li><p>Make sure you shift your neural data ~4.5 seconds ahead of your display to account for the HRF (if you’re using the raw signal; unnecessary if you’re using betas)</p></li>
<li><p>Keep in mind the 0-based indexing in python vs 1-based indexing you may have used in other parts of your experiment</p></li>
<li><p><strong>DO NOT USE PREDICT_PROBA UNLESS YOU’RE USING A LOGISTIC CLASSIFIER.</strong> All you need to know is that you can get weird results with categories flipped <em>sometimes but not every time</em> if you’re using other classifiers with the predict_proba function.</p></li>
<li><p>If you’re using an SVM classifier, and want to use the distance to the hyperplane as your proxy for classification—-if your data is z-scored, the mean distance to the hyperplane will be 0.</p></li>
<li><dl class="simple">
<dt>Monika’s wisdom:</dt><dd><ul>
<li><p>If there’s no signal in your randomized data, when you split to train/test, you may induce a signal by leaving some parts out → this would result in below chance classification</p></li>
<li><p>generating random distributions – you need to take the structure of your categories into account when generating “chance”. Like if you have sub-categories within one category you’re training on, make sure you’re building your randomized data set such that the two groups have balanced sub-categories.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<a class="reference external image-reference" href="01-05-overview.html"><img alt="return to timeline" class="align-center" src="../_images/return_to_timeline.png" style="width: 300px;" /></a>
</div>
</div>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="05-01-univariate.html" title="Previous document">Univariate regression and temporal filtering</a>
        </li>
        <li>
          <a href="05-03-surfaceBased.html" title="Next document">Surface-based analysis</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
<div class="footer">
  <div style="text-align: left;" id="waldo-tag-2171"></div>
  <p>&copy;2020 CC-BY-SA - <a href="website_info.html">Website Info</a></p>
</div>


 <script type="text/javascript">
    $(document).ready(function() {
        $(".toggle > *").hide();
        $(".toggle .header").show();
        $(".toggle .header").click(function() {
            $(this).parent().children().not(".header").toggle(400);
            $(this).parent().children(".header").toggleClass("open");
        })
    });
</script>

  </body>
</html>